{% extends "store/base.html" %}
{% block title %} Shop{% endblock title %}
{%block body %}

<div class="container mt-4">
  <div class="row text-center">
    <div class="col-sm-12 col-md-2 mt-1 ">
      <div class="row border">
        <form method="GET" id="form2">
          <input name="title" type="hidden" value="{{request.session.title}}" class="form_field">
          <div class="col-12">
            <label class="fs-5 fw-bolder mt-3">Categories</label>
          </div>
          <div class="col-12">
            <select class="form-select lwidth m-auto my-3" name="category">
              <option selected class="form_field fw-bold">{{request.session.category}}</option>
              {% for category in category_list%}
              <option value="{{category.name}}">{{category.name}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-12">
            <label class="fs-5 fw-bolder">Price</label>
          </div>
          <div class="col-12">
            <input type="number" class="form-control form_field" min="0" placeholder="From" aria-label="Min Price"
              name="min_price" value="{{request.session.min_price}}">
          </div>
          <label class="fs-5 fw-bolder ">-</label>
          <div class="col-12 ">
            <input type="number" class="form-control mt-1 form_field" min="0" placeholder="To" aria-label="Max Price"
              name="max_price" value="{{request.session.max_price}}">
          </div>
          <input type="button" class="btn btn-outline-success my-2" value="Reset filters" onclick="resetFilters();">
          <button class="btn btn-outline-primary my-2" onclick="checkAndSubmit();">Apply filters</button>
      </div>
    </div>
    </form>
    <div class="col-sm-12 col-md-9 mx-auto">
      <div class="row">
        {% for product in object_list %}
        <a href="{% url 'store:product_detail' product.id product.slug %}" class="clickable-div">
          <div class="row products mt-1 border-top">
            <div class="col-4 mt-1 mb-1 ">
              <img class="img-fluid rounded float-start" src="{{ product.image.url}}" alt="product_image" />
            </div>
            <div class="col-2 m-auto ">
              <h4>{{product.name}}</h4>
              <h5>${{product.price}}</h5>
            </div>
          </div>
        </a>
        {% empty %}
        <div class="col mt-3">
          <h3>No results for: "{{request.GET.title}}".</h3>
          <p>Try checking your spelling or use more general terms.</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
<ul class="pagination justify-content-center pagination-lg mt-4">
  {% if page_obj.has_previous %}
  <li class="page-item">
    <a class="page-link"
      href="{{ pagination_url }}1">First</a>
  </li>
  <li class="page-item">
    <a class="page-link"
      href="{{ pagination_url}}{{ page_obj.previous_page_number }}">Previous</a>
  </li>
  {% else %}
  <li class="page-item disabled">
    <span class="page-link">First</span>
  </li>
  <li class="page-item disabled">
    <span class="page-link">Previous</span>
  </li>
  {% endif %}
  <li class="page-item active" aria-current="page">
    <span class="page-link">{{ page_obj.number }}</span>
  </li>
  {% if page_obj.has_next %}
  <li class="page-item">
    <a class="page-link"
      href="{{ pagination_url}}{{ page_obj.next_page_number }}">Next</a>
  </li>
  <li class="page-item">
    <a class="page-link"
      href="{{ pagination_url}}{{ page_obj.paginator.num_pages }}">Last</a>
  </li>
  {% else %}
  <li class="page-item disabled">
    <span class="page-link">Next</span>
  </li>
  <li class="page-item disabled">
    <span class="page-link">Last</span>
  </li>
  {% endif %}
</ul>

<script type="text/javascript">
  checkAndSubmit = function () {
    event.preventDefault();
    var elements = document.getElementsByClassName("form_field");
    for (var i = 0; i < elements.length; i++) {
      if (elements[i].value === undefined || elements[i].value === "") {
        elements[i].disabled = true;
      } else {
        elements[i].disabled = false;
      }
    }
    document.getElementById("form2").submit();

  }
  resetFilters = function () {
    event.preventDefault();
    var elements = document.getElementsByClassName("form_field");
    if (elements[0].value === undefined || elements[0].value === "") {
      location.href = "/";
    } else {
      elements[0].disabled = false;
      // Starting with 1 to skip hidden "title" input
      for (var i = 1; i < elements.length; i++) {
        elements[i].value = undefined;
        elements[i].disabled = true;
      }
      document.getElementById("form2").submit();
    }

  }

</script>

{% endblock body %}